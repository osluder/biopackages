#$Id: ffmpeg.spec.in,v 1.2 2005/08/18 08:00:41 allenday Exp $
Summary: ffmpeg
Name: ffmpeg
Version: 0.4.9pre1
Epoch: 0
Release: %{revision}.%{distro}
Source0: ffmpeg-20050301.tar.gz
License: Custom 
Group: Development/Libraries
Packager: Allen Day <allenday@ucla.edu>
URL: http://www.ffmpeg.org
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
#Icon: 
Requires: lame, libogg, libvorbis, faac faad2, a52dec, imlib2
BuildRequires: biopackages, gcc, lame-devel, libogg-devel, libvorbis-devel, faac-devel, faad2-devel, a52dec-devel, imlib2-devel
Provides: libavcodec.so, libavformat.so

%description
ffmpeg

%prep
%setup -n %{name}

mkdir -p $RPM_BUILD_ROOT%{_bindir}
mkdir -p $RPM_BUILD_ROOT%{_libdir}
mkdir -p $RPM_BUILD_ROOT%{_includedir}/ffmpeg/libavcodec
mkdir -p $RPM_BUILD_ROOT%{_includedir}/ffmpeg/libavformat

%build
./configure \
  --prefix=$RPM_BUILD_ROOT/usr \
  --enable-shared \
  --enable-mp3lame \
  --enable-ogg \
  --enable-vorbis \
  --enable-faad \
  --enable-faac \
  --enable-a52 \
  --enable-pthreads \
  --enable-pp \
  --enable-shared-pp \
  --enable-gpl ;
make -j5;

%install
make install ;

#these .h files are not installed by make, but are needed to compile with ffmpeg.c
install -m 444 cmdutils.h $RPM_BUILD_ROOT%{_includedir}/ffmpeg
install -m 444 libavcodec/bswap.h $RPM_BUILD_ROOT%{_includedir}/ffmpeg/libavcodec/
install -m 444 libavcodec/dsputil.h $RPM_BUILD_ROOT%{_includedir}/ffmpeg/libavcodec/
install -m 444 libavformat/os_support.h $RPM_BUILD_ROOT%{_includedir}/ffmpeg/libavformat/
install -m 444 libavformat/framehook.h $RPM_BUILD_ROOT%{_includedir}/ffmpeg/libavformat/


[ -x /usr/lib/rpm/brp-compress ] && /usr/lib/rpm/brp-compress


find %{buildroot}%{_prefix} -type f -o -type l | sed "s@^%{buildroot}@@g" > %{name}-%{version}-%{release}-filelist

%files -f %{name}-%{version}-%{release}-filelist
%defattr(-,root,root)
%doc COPYING CREDITS INSTALL README config.h doc/ ffmpeg.c

%clean
[ "${RPM_BUILD_ROOT}" != "/" ] && [ -d ${RPM_BUILD_ROOT} ] && rm -rf ${RPM_BUILD_ROOT};

%post 

%preun 

%changelog
* Tue Mar 1 2005 Allen Day <allenday@ucla.edu>
- Added /etc/init.d/gfServer and /etc/bioinformatics/gfServer.conf
  for running gfServer as a daemon.
* Mon Feb 28 2005 Allen Day <allenday@ucla.edu>
- Added /usr/lib64/mysql to link path for x86_64 systems
- Several hg/makeDb/hg* targets were not installing to /usr/bin, changed
  sundry patches file to fix.
- Added blatSuite
* Wed Feb 9 2005 Allen Day <allenday@ucla.edu>
- Cleaned unused directives from specfile.
- Added commands to specfile that were used to generate patches.
* Mon Feb 7 2005 Allen Day <allenday@ucla.edu>
- New specfile, derived from R-2.0.1 specfile
