#$Id: biopackages.spec.in,v 1.14 2006/10/11 22:22:14 bpbuild Exp $
Summary: Files and utilities needed for building RPMs from the biopackages.net vendor, as well as apt and yum
Name: biopackages
Version: 1.0.1
Release: %{revision}
Epoch: 1
License: GPL
Group: Applications/Bioinformatics
URL: http://www.biopackages.net
Source0: %{name}.tar.gz
BuildArch: noarch
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-buildroot
BuildRequires: perl-DateManip
Requires: bash, usr-local-bin-perl, perl-DateManip

#%package server
#Summary: Files for running a biopackages apt and yum server
#Group: Applications/Bioinformatics
#Requires: httpd
##BuildRequires: apt

%description
Files and utilities needed for building RPMs from the bioRPM vendor, as well as yum

#%description server
#Provides skeleton directories for APT and Yum repositories for your RPMs

%prep
rm -rf %{buildroot}
%setup -n %{name}

%build
rm -rf %{buildroot}

%install
rm -rf %{buildroot}
mkdir -p %{buildroot}%{_bindir}
install -m 755 bp-distro %{buildroot}%{_bindir}
#install -m 755 bp-update %{buildroot}%{_bindir}
#install -m 755 bp-inject-binary %{buildroot}%{_bindir}
#install -m 755 bp-inject-source %{buildroot}%{_bindir}

#mkdir -p %{buildroot}/var/www/html/apt/{rh8,rh9,fc1,fc2,fc3,fc4}/{noarch,i386,x86_64}/{base,RPMS.stable,RPMS.testing,SRPMS.stable,SRPMS.testing} ;

##initialize redhat repositories
#for release in 8 9 ; do
#  for arch in noarch i386 ; do
#    for tag in base stable testing ; do
#      mkdir -p %{buildroot}/var/www/html/apt/rh$release/$arch/$tag
#    done ;
#  done ;
#done ;
#
##initialize fedora repositories
#for release in 1 2 3 4 ; do
#  for arch in noarch i386 ; do
#    for tag in base stable testing ; do
#      mkdir -p %{buildroot}/var/www/html/apt/fc$release/$arch/$tag
#    done ;
#  done ;
#done ;
#
#find %{buildroot}/var/www -type d | sed "s@^$RPM_BUILD_ROOT@%dir @g" >> %{name}-%{version}-%{release}-server

#%post server

##initialize redhat repositories
#for release in 8 9 ; do
#  for arch in noarch i386 ; do
#    genbasedir --flat --bloat --bz2only --partial --progress \
#      /var/www/html/apt/rh$release/$arch stable testing 2&>1 > /dev/null
#  done ;
#done ;
#
##initialize fedora repositories
#for release in 1 2 3 4 ; do
#  for arch in noarch i386 ; do
#    genbasedir --flat --bloat --bz2only --partial --progress \
#      /var/www/html/apt/fc$release/$arch stable testing 2&>1 > /dev/null
#  done ;
#done ;

%post
# turns out %{_libdir} points to /usr/lib64 on CentOS for noarch packages
# but the macros file is in /usr/lib
if [ -e /usr/lib/rpm/macros ]; then
  cp -prv /usr/lib/rpm/macros /usr/lib/rpm/macros.bak
  echo "%%distro %%(eval %{_bindir}/bp-distro)" >> /usr/lib/rpm/macros
else
  cp -prv %{_libdir}/rpm/macros %{_libdir}/rpm/macros.bak
  echo "%%distro %%(eval %{_bindir}/bp-distro)" >> %{_libdir}/rpm/macros
fi

#cp -prv /etc/apt/sources.list /etc/apt.sources.list.bak
#MACHTYPE=`echo $MACHTYPE | perl -ne '/^([^-]+)/;print $1'`
#TAG=`bp-distro -t`
#echo "# biopackages for $TAG / $MACHTYPE"                         >> /etc/apt/sources.list
#echo "rpm     http://www.biopackages.net apt/$TAG/$MACHTYPE stable"   >> /etc/apt/sources.list
#echo "rpm     http://www.biopackages.net apt/$TAG/$MACHTYPE testing"  >> /etc/apt/sources.list
#echo "#rpm-src http://www.biopackages.net apt/$TAG/$MACHTYPE stable"  >> /etc/apt/sources.list
#echo "#rpm-src http://www.biopackages.net apt/$TAG/$MACHTYPE testing" >> /etc/apt/sources.list

%clean
rm -rf %{buildroot}

%files
%defattr(-,root,root,-)
%{_bindir}/bp-distro
#%{_bindir}/bp-inject-binary
#%{_bindir}/bp-inject-source

#%files server -f %{name}-%{version}-%{release}-server
#%defattr(-,root,root,-)
#/usr/bin/bp-update

$Log: biopackages.spec.in,v $
Revision 1.14  2006/10/11 22:22:14  bpbuild
Changes to deps

Revision 1.13  2006/10/04 22:13:45  bpbuild
new source

Revision 1.12  2006/09/09 23:41:12  boconnor
Updates deps

Revision 1.11  2006/09/07 18:33:10  boconnor
Update to if

Revision 1.10  2006/09/07 18:27:39  boconnor
Update to if

Revision 1.9  2006/09/07 18:10:37  boconnor
perl ln

Revision 1.8  2006/09/04 10:47:58  boconnor
Updates to deps and also some extra code in the biopackages spec to support strangeness in CentOS on x86_64

Revision 1.7  2006/07/10 17:33:33  boconnor
Added spec.in files for several packages that were previously built on the testing branch and not yet imported into the biopackages system

Revision 1.6  2006/01/04 22:26:11  allenday
sync changes log to cvs log


